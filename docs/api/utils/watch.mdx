---
title: 'watch'
section: 'API'
subSection: 'Utils'
description: 'watch for changes.'
---

# watch

#### subscription via a getter

This utility supports subscribing to multiple proxy objects (unlike `subscribe` which listens to only a single proxy). Proxy objects are tracked with a `sub` function passed to the callback.

The callback will rerun anytime a `sub`-d proxy (or child proxy of that proxy) has any of its keys mutated, regardless of the keys accessed within the `callback`'s code (i.e. `watch` does not implement the usage tracking of `useSnapshot`, and the return value of `sub` is the same proxy passed in, and not a snapshot).

Also note the callback will run once immediately when `watch` is called, even if not yet mutated, to establish the initial proxy subscriptions.

```js
import { proxy } from 'valtio'
import { watch } from 'valtio/utils'

const userState = proxy({ user: { name: 'Juuso' } })
const sessionState = proxy({ expired: false })

watch((sub) => {
  // Call sub to subscribe
  sub(sessionState);
  const expired = sessionState.expired
  // Or call it inline
  const name = sub(userState).user.name
  console.log(`${name}'s session is ${expired ? 'expired' : 'valid'}`)
})
// 'Juuso's session is valid'
sessionState.expired = true
// 'Juuso's session is expired'
```

#### cleanup

You may return a callback function that runs after watch has evaluated its dependencies.

```js
watch((sub) => {
  const expired = sub(sessionState).expired
  const name = sub(userState).user.name
  console.log(`${name}'s session is ${expired ? 'expired' : 'valid'}`)
  return () => {
    if (expired) {
      console.log('Cleaning up')
    }
  }
})
// 'Juuso's session is valid'
sessionState.expired = true
// 'Juuso's session is expired'
setTimeout(() => {
  userState.user.name = 'Anonymous'
}, 200)
// 200ms -> 'Anonymous's session is expired"
// 'Cleaning up' logged
```

#### gotchas

If you remove the setTimeout in the example above, 'Juuso's session is expired' will become 'Anonymous's session is expired', logged twice. Valtio will batch updates by default. You may pass `{sync: true}` as a second argument to `watch` to disable batching.
